services:
  openclaw-agent:
    build: .
    restart: unless-stopped
    environment:
      # Provided via Coolify
      AGENT_NAME: ${AGENT_NAME:-openclaw-agent}
      PORT: ${PORT:-3000}
      POCKETBASE_URL: ${POCKETBASE_URL:-https://api.cloudfreedom.de}
      POCKETBASE_API_TOKEN: ${POCKETBASE_API_TOKEN}
      CLOUDFREEDOM_ROUTER_BASE_URL: ${CLOUDFREEDOM_ROUTER_BASE_URL:-https://router.cloudfreedom.de}
      CLOUDFREEDOM_API_KEY: ${CLOUDFREEDOM_API_KEY}
      # optional webhook secret for inbound triggers
      WEBHOOK_SECRET: ${WEBHOOK_SECRET:-}
      LOG_LEVEL: ${LOG_LEVEL:-info}
    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://127.0.0.1:3000/healthz"]
      interval: 30s
      timeout: 5s
      retries: 3
    deploy:
      resources:
        limits:
          cpus: "1.0"
          memory: 1024M
        reservations:
          cpus: "0.10"
          memory: 256M
    labels:
      # If you want a public webhook endpoint, enable Traefik and set DOMAIN.
      - "traefik.enable=${TRAEFIK_ENABLE:-false}"
      - "traefik.http.routers.${STACK_NAME:-openclaw}.rule=Host(`${DOMAIN}`)"
      - "traefik.http.routers.${STACK_NAME:-openclaw}.entrypoints=websecure"
      - "traefik.http.routers.${STACK_NAME:-openclaw}.tls=true"
      - "traefik.http.services.${STACK_NAME:-openclaw}.loadbalancer.server.port=3000"
