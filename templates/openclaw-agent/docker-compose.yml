# CloudFreedom Agent Platform — OpenClaw Agent Template
# Tested & working on Coolify 4.x (2026-02-16)
#
# Required env vars (set in Coolify):
#   TENANT_ID - unique tenant identifier
#
# Optional env vars:
#   NODE_OPTIONS     - Node.js options (default: --max-old-space-size=1536)
#   CPU_LIMIT        - CPU limit (default: 1.0)
#   MEMORY_LIMIT     - Memory limit (default: 2G) — OpenClaw needs ~500MB idle
#   ANTHROPIC_API_KEY, OPENAI_API_KEY, GOOGLE_API_KEY - LLM provider keys
#   TELEGRAM_BOT_TOKEN - for Telegram channel
#   DISCORD_BOT_TOKEN  - for Discord channel

services:
  agent:
    image: ghcr.io/openclaw/openclaw:latest
    restart: unless-stopped
    environment:
      NODE_ENV: production
      NODE_OPTIONS: "${NODE_OPTIONS:---max-old-space-size=1536}"
    volumes:
      - agent-data:/home/node/.openclaw
    deploy:
      resources:
        limits:
          cpus: "${CPU_LIMIT:-1.0}"
          memory: "${MEMORY_LIMIT:-2G}"
        reservations:
          cpus: "0.25"
          memory: 512M
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    read_only: true
    tmpfs:
      - /tmp
    user: "1000:1000"

volumes:
  agent-data: